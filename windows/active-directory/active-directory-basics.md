---
description: https://tryhackme.com/room/winadbasics
---

# Active Directory Basics

## Windows Domains.

Imagínese administrando una red de una pequeña empresa con solo cinco ordenadores y cinco empleados. En una red tan pequeña, probablemente podrá configurar cada ordenador por separado sin ningún problema. Entrarás manualmente en cada ordenador, crearás usuarios para quien los vaya a utilizar y harás configuraciones específicas para las cuentas de cada empleado. Si el ordenador de un usuario deja de funcionar, probablemente irás a su casa y lo arreglarás en sitio.

Aunque esto parece un estilo de vida muy relajado, supongamos que su empresa crece de repente y ahora tiene 157 ordenadores y 320 usuarios diferentes repartidos por cuatro oficinas distintas. ¿Seguiría siendo capaz de gestionar cada ordenador como una entidad independiente, configurar manualmente las políticas para cada uno de los usuarios de la red y proporcionar asistencia en sitio para todos? Lo más probable es que la respuesta sea no.

Para superar estas limitaciones, podemos usar un **dominio de Windows**. En pocas palabras, un dominio de Windows es un grupo de usuarios y ordenadores bajo la administración de una empresa determinada. La idea principal de un dominio es centralizar la administración de los componentes comunes de una red de ordenadores Windows en un único repositorio llamado **Directorio Activo** (AD). El servidor que ejecuta los servicios de Active Directory se conoce como **controlador de dominio** (DC).

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Las principales ventajas de tener un dominio Windows configurado son:

* **Gestión de identidades centralizada**: Todos los usuarios de la red pueden configurarse desde Active Directory con el mínimo esfuerzo.&#x20;
* **Gestión de las políticas de seguridad**: Puede configurar las políticas de seguridad directamente desde Active Directory y aplicarlas a los usuarios y ordenadores de toda la red según sea necesario.

## A Real-World Example

Si esto suena un poco confuso, es probable que ya hayas interactuado con un dominio de Windows en algún momento de tu escuela, universidad o trabajo.

En las redes escolares/universitarias, a menudo se te proporcionará un nombre de usuario y una contraseña que podrás utilizar en cualquiera de los ordenadores disponibles en el campus. Tus credenciales son válidas para todas las máquinas porque cada vez que las introduzcas en una máquina, esta reenviará el proceso de autenticación al Directorio Activo, donde se comprobarán tus credenciales. Gracias a Active Directory, tus credenciales no necesitan existir en cada máquina y están disponibles en toda la red.

El Directorio Activo es también el componente que permite a su escuela/universidad restringirle el acceso al panel de control en sus máquinas escolares/universitarias. Por lo general, las políticas se desplegarán en toda la red para que no tengas privilegios administrativos sobre esos ordenadores.

## Active Directory

El núcleo de cualquier dominio de Windows es el **servicio de dominio de Active Directory (AD DS)**. Este servicio actúa como un catálogo que contiene la información de todos los "objetos" que existen en su red. Entre los muchos objetos que soporta AD, tenemos usuarios, grupos, máquinas, impresoras, recursos compartidos y muchos otros. Veamos algunos de ellos:

### Users

Los usuarios son uno de los tipos de objetos más comunes en Active Directory. Los usuarios son uno de los objetos conocidos como [**`entidades de seguridad`**](https://docs.microsoft.com/es-es/windows-server/identity/ad-ds/manage/understand-security-principals), lo que significa que pueden ser autenticados por el dominio y se les pueden asignar privilegios sobre **recursos** como archivos o impresoras. Se puede decir que una **entidad de seguridad** es un objeto que puede actuar sobre los recursos de la red.

Los usuarios pueden ser utilizados para representar dos tipos de entidades:

* **Personas**: los usuarios generalmente representarán a las personas de su organización que necesitan acceder a la red, como los empleados.&#x20;
* **Servicios**: también puede definir usuarios para ser utilizados por servicios como IIS o MSSQL. Cada servicio requiere un usuario para funcionar, pero los usuarios de servicios son diferentes de los usuarios normales, ya que solo tendrán los privilegios necesarios para ejecutar su servicio específico.

### Machines

Las máquinas son otro tipo de objeto dentro de Active Directory; por cada ordenador que se incorpore al dominio de Active Directory, se creará un objeto máquina. Las máquinas también se consideran "entidades de seguridad" y se les asigna una cuenta como a cualquier usuario normal. Esta cuenta tiene derechos algo limitados dentro del propio dominio.

Las cuentas de máquina en sí son administradores locales en el ordenador asignado, generalmente no se supone que nadie pueda acceder a ellas excepto el propio ordenador, pero como con cualquier otra cuenta, si tienes la contraseña, puedes usarla para entrar.

**Nota**: Las contraseñas de las cuentas de máquinas se rotan automáticamente y suelen estar compuestas por 120 caracteres aleatorios.

Identificar las cuentas de las máquinas es relativamente fácil. Siguen un esquema de nomenclatura específico. El nombre de la cuenta de máquina es el nombre del ordenador seguido de un signo de dólar. Por ejemplo, una máquina llamada **DC01** tendrá una cuenta de máquina llamada **DC01$**.

### Security Groups

Si está familiarizado con Windows, probablemente sepa que puede definir grupos de usuarios para asignar derechos de acceso a archivos u otros recursos a grupos enteros en lugar de a usuarios individuales. Esto permite una mejor gestión, ya que puede añadir usuarios a un grupo existente y éstos heredarán automáticamente todos los privilegios del grupo. Los grupos de seguridad también se consideran directores de seguridad y, por tanto, pueden tener privilegios sobre los recursos de la red.

Los grupos pueden tener tanto usuarios como máquinas como miembros. Si es necesario, los grupos pueden incluir también otros grupos.

En un dominio se crean varios grupos por defecto que pueden utilizarse para conceder privilegios específicos a los usuarios. A modo de ejemplo, estos son algunos de los grupos más importantes en un dominio:

| Security Group     | Description                                                                                                                                                                     |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Domain Admins      | Los usuarios de este grupo tienen privilegios administrativos sobre todo el dominio. Por defecto, pueden administrar cualquier equipo del dominio, incluidos los DC.            |
| Server Operators   | Los usuarios de este grupo pueden administrar los Controladores de Dominio. No pueden cambiar ninguna pertenencia a grupos administrativos.                                     |
| Backup Operators   | Los usuarios de este grupo pueden acceder a cualquier archivo, sin tener en cuenta sus permisos. Se utilizan para realizar copias de seguridad de los datos en los ordenadores. |
| Account Operators  | Los usuarios de este grupo pueden crear o modificar otras cuentas en el dominio.                                                                                                |
| Domain Users       | Incluye todas las cuentas de usuario existentes en el dominio.                                                                                                                  |
| Domain Computers   | Incluye todos los ordenadores existentes en el dominio.                                                                                                                         |
| Domain Controllers | Incluye todos los DCs existentes en el dominio.                                                                                                                                 |

{% embed url="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups" %}
Lista completa de grupos de seguridad por defecto
{% endembed %}

### Active Directory Users and Computers

Para configurar usuarios, grupos o equipos en Active Directory, debemos acceder al controlador de dominio y ejecutar "Usuarios y equipos de Active Directory" desde el menú de inicio:

<figure><img src="../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

Esto abrirá una ventana en la que podrá ver la jerarquía de usuarios, equipos y grupos que existen en el dominio. Estos objetos están organizados en **Unidades Organizativas** (OUs) que son objetos contenedores que permiten clasificar a los usuarios y equipos. Las OUs se usan principalmente para definir conjuntos de usuarios con requisitos de control similares. Es probable que a las personas del departamento de ventas de su organización se les aplique un conjunto diferente de políticas que a las personas de TI, por ejemplo. Ten en cuenta que un usuario sólo puede formar parte de una única OU a la vez.

**OU:** En los dominios de Windows, la Unidad Organizativa (OU) se refiere a los contenedores que contienen usuarios, grupos y ordenadores a los que se deben aplicar políticas similares. En la mayoría de los casos, las OUs coinciden con los departamentos de una empresa.

Comprobando nuestra máquina, podemos ver que ya hay una OU llamada `THM` con cuatro OUs hijas para los departamentos de TI, Gestión, Marketing y Ventas. Es muy típico ver que las OUs imitan la estructura de la empresa, ya que permite desplegar eficientemente políticas de base que se aplican a departamentos enteros. Recuerde que aunque este sería el modelo esperado la mayoría de las veces, puede definir las OUs de forma arbitraria. Siéntase libre de hacer clic con el botón derecho del ratón en la OU de `THM` y crear una nueva OU bajo ella llamada `Students` sólo por diversión.

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

Si abres cualquier OU, puedes ver los usuarios que contienen y realizar tareas sencillas como crearlos, eliminarlos o modificarlos según sea necesario. También puede restablecer las contraseñas si es necesario (bastante útil para el servicio de asistencia):

<figure><img src="../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

Probablemente ya se haya dado cuenta de que hay otros contenedores por defecto aparte del THM OU. Estos contenedores son creados por Windows automáticamente y contienen lo siguiente:

* **Builtin**: Contiene grupos por defecto disponibles para cualquier host de Windows.&#x20;
* **Computers**: Cualquier máquina que se incorpore a la red se pondrá aquí por defecto. Puede moverlos si es necesario.&#x20;
* **Domain Controllers**: OU por defecto que contiene los DCs de su red.&#x20;
* **Users**: Usuarios y grupos por defecto que se aplican a un contexto de todo el dominio.&#x20;
* **Managed Service Accounts**: Contiene las cuentas utilizadas por los servicios en su dominio de Windows.

### Security Groups vs OUs

Probablemente se pregunte por qué tenemos tanto grupos como OUs. Aunque ambos se utilizan para clasificar a los usuarios y a los ordenadores, sus propósitos son totalmente diferentes:

Las **OUs** son útiles para **aplicar políticas** a los usuarios y ordenadores, que incluyen configuraciones específicas que pertenecen a conjuntos de usuarios dependiendo de su rol particular en la empresa. Recuerda que un usuario sólo puede ser miembro de una única OU a la vez, ya que no tendría sentido intentar aplicar dos conjuntos diferentes de políticas a un único usuario.&#x20;

Los **grupos de seguridad**, por otro lado, se utilizan para **conceder permisos sobre los recursos**. Por ejemplo, utilizarás los grupos si quieres permitir que algunos usuarios accedan a una carpeta compartida o a una impresora de red. Un usuario puede formar parte de muchos grupos, lo cual es necesario para conceder acceso a múltiples recursos.

## Managing Users in AD

Su primera tarea como nuevo administrador de dominio es comprobar las OUs y los usuarios de AD existentes, ya que se han producido algunos cambios recientes en la empresa. Se le ha dado el siguiente organigrama y se espera que haga cambios en el AD para que coincida con él:

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

Deleting extra OUs and users

Lo primero que debería notar es que hay una OU de departamento adicional en su configuración actual de AD que no aparece en el gráfico. Nos han dicho que se cerró debido a los recortes presupuestarios y que debe eliminarse del dominio. Si intentas hacer clic con el botón derecho y eliminar la OU, obtendrás el siguiente error:\


<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Por defecto, las OUs están protegidas contra el borrado accidental. Para borrar la OU, necesitamos habilitar las **Características Avanzadas** en el menú View.

<figure><img src="../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

Esto le mostrará algunos contenedores adicionales y le permitirá desactivar la protección contra el borrado accidental. Para ello, haga clic con el botón derecho del ratón en la OU y vaya a Propiedades. Encontrará una casilla de verificación en la pestaña Objeto para desactivar la protección:

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Asegúrate de desmarcar la casilla e intenta borrar la OU de nuevo. Se le pedirá que confirme que desea eliminar la OU, y como resultado, cualquier usuario, grupo u OU bajo ella también se eliminará.

Después de eliminar la OU extra, deberías notar que para algunos de los departamentos, los usuarios en el AD no coinciden con los de nuestro organigrama. Cree y elimine los usuarios que sean necesarios para que coincidan.

