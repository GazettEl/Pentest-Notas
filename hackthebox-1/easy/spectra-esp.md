---
description: 'https://www.hackthebox.eu/home/machines/profile/317'
---

# Spectra

Máquina Linux con tres puertos abiertos  22:ssh, 80:http, 3306:mysql.

![](../../.gitbook/assets/0%20%2814%29.png)

## Enumeración

Lo primero que hago es realizar un escaneo con nmap para saber los puertos abiertos en el rango del 1-65536.

```text
# Nmap 7.91 scan initiated Mon Mar 1 19:51:04 2021 as: nmap -p- --open -n -T5 -v -oG allPorts 10.10.10.229
# Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 10.10.10.229 () Status: Up
Host: 10.10.10.229 () Ports: 22/open/tcp//ssh///, 80/open/tcp//http///, 3306/open/tcp//mysql/// Ignored State: closed (65532)
# Nmap done at Mon Mar 1 19:51:31 2021 -- 1 IP address (1 host up) scanned in 27.37 seconds
# Nmap 7.91 scan initiated Mon Mar 1 19:52:20 2021 as: nmap -sCV -p22,80,3306 -oN targeted 10.10.10.229
```

| Bandera | Descripción |
| :--- | :--- |
| -p- | Escaneo a los 65536 puertos |
| --open | Reporta solo los puertos con estado "open". |
| -T5 | Exploracion a velocidades insanas \(lo hago porque es un entorno de pruebas\). |
| -v | Muestra más información sobre el sondeo que se está realizando. |
| -oG allPorts | Exporta los resultados en un formato Grepable con el nombre de allPorts. |

Posteriormente verificamos las versiones de los servicios y haremos uso de scripts por default.

```text
Nmap scan report for 10.10.10.229
Host is up (0.074s latency).
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 8.1 (protocol 2.0)
| ssh-hostkey:
|_ 4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA)
80/tcp open http nginx 1.17.4
|_http-server-header: nginx/1.17.4
|_http-title: Site doesn't have a title (text/html).
3306/tcp open mysql MySQL (unauthorized)
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Mar 1 19:53:00 2021 -- 1 IP address (1 host up) scanned in 40.48 seconds
```

| Bandera | Descripción |
| :--- | :--- |
| -p22,80,3306 | Escaneo a los puertos 22, 80 y 3306. |
| -sC | Escanea con los scripts por defecto. |
| -sV | Intenta determinar la versión del servicio que se ejecuta en el puerto. |
| -oN | Exporta los resultados en un formato nmap. |

Vistazo a la web.

![](../../.gitbook/assets/1%20%285%29.png)

Añadiendo vhost a /etc/hosts

```text
echo “10.10.10.229 spectra.htb” >> /etc/hosts
```

Fuzzing en spectra.htb/

```text
wfuzz -c --hc=404 --hh=283 -L -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://spectra.htb/FUZZ 2>/dev/null
=====================================================================
ID Response Lines Word Chars Payload
=====================================================================
000000077: 200 346 L 1471 W 26162 Ch "main"
000001472: 200 26 L 111 W 2514 Ch "testing"
```

Fuzzing en spectra.htb/testing

```text
wfuzz -c --hc=404 --hh=2514 -L -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://spectra.htb/testing/FUZZ 2>/dev/null
=====================================================================
ID Response Lines Word Chars Payload
=====================================================================
000000241: 200 10 L 31 W 627 Ch "wp-content"
000000786: 200 214 L 1051 W 25891 Ch "wp-includes"
000007180: 200 101 L 486 W 11460 Ch "wp-admin"
```

Fuzzing en spectra.htb/main

```text
wfuzz -c --hc=404 --hh=26162 -L -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://spectra.htb/main/FUZZ 2>/dev/null
=====================================================================
ID Response Lines Word Chars Payload
=====================================================================
000000241: 200 0 L 0 W 0 Ch "wp-content"
000000786: 403 7 L 9 W 153 Ch "wp-includes"
000007180: 200 85 L 292 W 4902 Ch "wp-admin"
```

Vemos que ambos tienen un wordpress.

Es posible listar el contenido en spectra.htb/testing, el cual contiene un importante de WordPress que guarda configuraciones, wp-content.php, en este caso estaba con .save me imagino que una copia, no se observará nada pero un ctrl+u y se agrega.

![](../../.gitbook/assets/image%20%2845%29.png)

Tenemos un password

```text
password: devteam01
```

Probando con el usuario administrador, la contraseña funciono.

![](../../.gitbook/assets/2%20%288%29.png)

## Punto de acceso

Solo seguí los pasos en los siguientes enlaces para obtener una conexión con el servidor.

{% embed url="https://www.hacknos.com/wordpress-shell-upload/" %}

{% embed url="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php" %}

El archivo fue subido de manera exitosa.

![](../../.gitbook/assets/3%20%288%29.png)

## Movimiento lateral

### Usuario katie

En una terminal lanzamos una petición al recurso.

```text
curl -v http://spectra.htb/main/wp-content/uploads/2021/03/php-reverse-shell.php
```

Y obtendremos acceso.

![](../../.gitbook/assets/4%20%282%29.png)

Después de enumerar el sistema por un rato, en la carpeta /opt se encuentra le siguiente archivo de configuración.

![](../../.gitbook/assets/5%20%2813%29.png)

El cual tenía una ruta al siguiente archivo, por lo visto una contraseña.

![](../../.gitbook/assets/6%20%2810%29.png)

Esta contraseña pertenece al usuario katie, una vez dentro pase a listar si es que podemos ejecutar algo como root, en este caso initctl.

![](../../.gitbook/assets/7%20%2815%29.png)

Podemos escribir en los archivos de configuración, por lo que podemos inyectar cualquier tipo de comando que queramos.

![](../../.gitbook/assets/8%20%2810%29.png)

## Escalada de privilegios

Simplemente podemos asignar privilegios SUID a bash y podemos obtener root de manera facil.

![](../../.gitbook/assets/9%20%281%29.png)

Ejecutamos y eso seria todo.

![](../../.gitbook/assets/10%20%289%29.png)

